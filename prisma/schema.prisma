// BizArch ERP - Database Schema
// Prisma 7.x with PostgreSQL on Neon

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ==================== ORGANIZATIONS ====================

model Organization {
  id                 String   @id @default(cuid())
  name               String
  slug               String   @unique
  gstEnabled         Boolean  @default(false)
  eInvoicingEnabled  Boolean  @default(false)
  multiUnitEnabled   Boolean  @default(false)
  multiBranchEnabled Boolean  @default(false)
  gstin              String?
  gstStateCode       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  users                      User[]
  customers                  Customer[]
  customerAssignments        CustomerAssignment[]
  customerTransactions       CustomerTransaction[]
  suppliers                  Supplier[]
  supplierTransactions       SupplierTransaction[]
  products                   Product[]
  units                      Unit[]
  invoices                   Invoice[]
  invoiceItems               InvoiceItem[]
  quotations                 Quotation[]
  quotationItems             QuotationItem[]
  purchaseInvoices           PurchaseInvoice[]
  purchaseInvoiceItems       PurchaseInvoiceItem[]
  creditNotes                CreditNote[]
  creditNoteItems            CreditNoteItem[]
  debitNotes                 DebitNote[]
  debitNoteItems             DebitNoteItem[]
  debitNoteLotConsumptions   DebitNoteLotConsumption[]
  payments                   Payment[]
  paymentAllocations         PaymentAllocation[]
  supplierPayments           SupplierPayment[]
  supplierPaymentAllocations SupplierPaymentAllocation[]
  stockLots                  StockLot[]
  stockLotConsumptions       StockLotConsumption[]
  openingStocks              OpeningStock[]
  costAuditLogs              CostAuditLog[]
  settings                   Setting[]
  accounts                   Account[]
  cashBankAccounts           CashBankAccount[]
  cashBankTransactions       CashBankTransaction[]
  expenses                   Expense[]
  expenseItems               ExpenseItem[]
  journalEntries             JournalEntry[]
  journalEntryLines          JournalEntryLine[]
  productCategories          ProductCategory[]
  posSessions                POSSession[]
  posHeldOrders              POSHeldOrder[]
  unitConversions            UnitConversion[]
  branches                   Branch[]
  warehouses                 Warehouse[]
  stockTransfers             StockTransfer[]
  stockTransferItems         StockTransferItem[]
  userWarehouseAccess        UserWarehouseAccess[]

  @@map("organizations")
}

// ==================== AUTH ====================

model User {
  id             String        @id @default(cuid())
  email          String        @unique
  password       String
  name           String
  role           String        @default("user") // superadmin, admin, user
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  customerAssignments CustomerAssignment[]
  invoices            Invoice[]
  creditNotes         CreditNote[]
  posSessions         POSSession[]
  warehouseAccess     UserWarehouseAccess[]

  @@index([organizationId])
  @@index([organizationId, name])
  @@map("users")
}

// ==================== UNITS ====================

model Unit {
  id             String       @id @default(cuid())
  code           String
  name           String
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  products             Product[]
  invoiceItems         InvoiceItem[]
  purchaseInvoiceItems PurchaseInvoiceItem[]
  quotationItems       QuotationItem[]
  creditNoteItems      CreditNoteItem[]
  debitNoteItems       DebitNoteItem[]
  conversionsFrom      UnitConversion[]      @relation("FromUnit")
  conversionsTo        UnitConversion[]      @relation("ToUnit")

  @@unique([organizationId, code])
  @@index([organizationId])
  @@map("units")
}

// ==================== PRODUCTS ====================

model Product {
  id             String           @id @default(cuid())
  name           String
  description    String?
  price          Decimal          @db.Decimal(10, 2)
  cost           Decimal          @default(0) @db.Decimal(10, 2)
  unitCode       String?
  unitId         String?
  unit           Unit?            @relation(fields: [unitId], references: [id])
  sku            String?
  barcode        String?
  hsnCode        String?
  gstRate        Decimal          @default(0) @db.Decimal(5, 2)
  isService      Boolean          @default(false)
  isActive       Boolean          @default(true)
  organizationId String
  organization   Organization     @relation(fields: [organizationId], references: [id])
  categoryId     String?
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  invoiceItems         InvoiceItem[]
  purchaseInvoiceItems PurchaseInvoiceItem[]
  stockLots            StockLot[]
  openingStocks        OpeningStock[]
  quotationItems       QuotationItem[]
  creditNoteItems      CreditNoteItem[]
  debitNoteItems       DebitNoteItem[]
  costAuditLogs        CostAuditLog[]
  stockTransferItems   StockTransferItem[]

  @@unique([organizationId, sku])
  @@unique([organizationId, barcode])
  @@index([organizationId])
  @@index([organizationId, name])
  @@index([organizationId, categoryId])
  @@map("products")
}

model UnitConversion {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  fromUnitId String
  fromUnit   Unit   @relation("FromUnit", fields: [fromUnitId], references: [id])

  toUnitId String
  toUnit   Unit   @relation("ToUnit", fields: [toUnitId], references: [id])

  conversionFactor Decimal @db.Decimal(10, 4)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([organizationId, fromUnitId, toUnitId])
  @@index([organizationId])
  @@index([fromUnitId])
  @@index([toUnitId])
  @@map("unit_conversions")
}

// ==================== CUSTOMERS ====================

model Customer {
  id             String       @id @default(cuid())
  name           String
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  zipCode        String?
  country        String?      @default("India")
  gstin          String?
  gstStateCode   String?
  balance        Decimal      @default(0) @db.Decimal(12, 2)
  notes          String?
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  invoices      Invoice[]
  payments      Payment[]
  transactions  CustomerTransaction[]
  quotations    Quotation[]
  assignments   CustomerAssignment[]
  creditNotes   CreditNote[]
  posHeldOrders POSHeldOrder[]

  @@index([organizationId])
  @@index([organizationId, name])
  @@map("customers")
}

model CustomerAssignment {
  id             String       @id @default(cuid())
  customerId     String
  userId         String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  assignedAt     DateTime     @default(now())

  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([customerId, userId])
  @@index([organizationId])
  @@map("customer_assignments")
}

// ==================== SUPPLIERS ====================

model Supplier {
  id             String       @id @default(cuid())
  name           String
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  zipCode        String?
  country        String?      @default("India")
  gstin          String?
  gstStateCode   String?
  balance        Decimal      @default(0) @db.Decimal(12, 2)
  notes          String?
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  purchaseInvoices PurchaseInvoice[]
  payments         SupplierPayment[]
  transactions     SupplierTransaction[]
  debitNotes       DebitNote[]
  expenses         Expense[]

  @@index([organizationId])
  @@index([organizationId, name])
  @@map("suppliers")
}

// ==================== INVOICES (SALES) ====================

model Invoice {
  id             String       @id @default(cuid())
  invoiceNumber  String
  customerId     String
  customer       Customer     @relation(fields: [customerId], references: [id])
  createdById    String?
  createdBy      User?        @relation(fields: [createdById], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  issueDate DateTime @default(now())
  dueDate   DateTime

  subtotal   Decimal @db.Decimal(12, 2)
  total      Decimal @db.Decimal(12, 2)
  amountPaid Decimal @default(0) @db.Decimal(12, 2)
  balanceDue Decimal @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  eInvoiceIrn      String?
  eInvoiceAckNo    String?
  eInvoiceAckDate  DateTime?
  eInvoiceSignedQr String?   @db.Text
  eInvoiceStatus   String?

  sentAt DateTime?

  notes String?
  terms String?

  sourceType   InvoiceSourceType @default(MANUAL)
  posSessionId String?
  posSession   POSSession?       @relation(fields: [posSessionId], references: [id])

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items              InvoiceItem[]
  payments           Payment[]
  paymentAllocations PaymentAllocation[]
  quotation          Quotation?
  creditNotes        CreditNote[]

  @@unique([organizationId, invoiceNumber])
  @@index([organizationId])
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([organizationId, issueDate(sort: Desc)])
  @@index([organizationId, customerId])
  @@map("invoices")
}

model InvoiceItem {
  id             String       @id @default(cuid())
  invoiceId      String
  invoice        Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  productId String?
  product   Product? @relation(fields: [productId], references: [id])
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])

  conversionFactor Decimal @default(1) @db.Decimal(10, 4)

  description String
  quantity    Decimal @db.Decimal(10, 2)
  unitPrice   Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  total       Decimal @db.Decimal(12, 2)

  hsnCode    String?
  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstRate   Decimal @default(0) @db.Decimal(5, 2)
  sgstRate   Decimal @default(0) @db.Decimal(5, 2)
  igstRate   Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  costOfGoodsSold Decimal @default(0) @db.Decimal(12, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lotConsumptions StockLotConsumption[]
  costAuditLogs   CostAuditLog[]

  @@index([organizationId])
  @@map("invoice_items")
}

// ==================== QUOTATIONS ====================

model Quotation {
  id              String       @id @default(cuid())
  quotationNumber String
  customerId      String
  customer        Customer     @relation(fields: [customerId], references: [id])
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id])

  issueDate  DateTime @default(now())
  validUntil DateTime

  status QuotationStatus @default(SENT)

  subtotal Decimal @db.Decimal(12, 2)
  total    Decimal @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  notes String?
  terms String?

  convertedInvoiceId String?   @unique
  convertedInvoice   Invoice?  @relation(fields: [convertedInvoiceId], references: [id])
  convertedAt        DateTime?

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items QuotationItem[]

  @@unique([organizationId, quotationNumber])
  @@index([organizationId])
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([organizationId, status])
  @@map("quotations")
}

enum QuotationStatus {
  SENT
  CONVERTED
  CANCELLED
  EXPIRED
}

model QuotationItem {
  id             String       @id @default(cuid())
  quotationId    String
  quotation      Quotation    @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  productId String?
  product   Product? @relation(fields: [productId], references: [id])
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])

  conversionFactor Decimal @default(1) @db.Decimal(10, 4)

  description String
  quantity    Decimal @db.Decimal(10, 2)
  unitPrice   Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  total       Decimal @db.Decimal(12, 2)

  hsnCode    String?
  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstRate   Decimal @default(0) @db.Decimal(5, 2)
  sgstRate   Decimal @default(0) @db.Decimal(5, 2)
  igstRate   Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizationId])
  @@map("quotation_items")
}

// ==================== PURCHASE INVOICES ====================

model PurchaseInvoice {
  id                    String       @id @default(cuid())
  purchaseInvoiceNumber String
  supplierId            String
  supplier              Supplier     @relation(fields: [supplierId], references: [id])
  organizationId        String
  organization          Organization @relation(fields: [organizationId], references: [id])

  invoiceDate        DateTime @default(now())
  dueDate            DateTime
  supplierInvoiceRef String?

  status PurchaseInvoiceStatus @default(DRAFT)

  subtotal   Decimal @db.Decimal(12, 2)
  total      Decimal @db.Decimal(12, 2)
  amountPaid Decimal @default(0) @db.Decimal(12, 2)
  balanceDue Decimal @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  notes String?

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items              PurchaseInvoiceItem[]
  payments           SupplierPayment[]
  paymentAllocations SupplierPaymentAllocation[]
  stockLots          StockLot[]
  debitNotes         DebitNote[]

  @@unique([organizationId, purchaseInvoiceNumber])
  @@index([organizationId])
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([organizationId, invoiceDate(sort: Desc)])
  @@index([organizationId, supplierId])
  @@index([organizationId, status])
  @@map("purchase_invoices")
}

enum PurchaseInvoiceStatus {
  DRAFT
  RECEIVED
  PAID
  PARTIALLY_PAID
  CANCELLED
}

model PurchaseInvoiceItem {
  id                String          @id @default(cuid())
  purchaseInvoiceId String
  purchaseInvoice   PurchaseInvoice @relation(fields: [purchaseInvoiceId], references: [id], onDelete: Cascade)
  organizationId    String
  organization      Organization    @relation(fields: [organizationId], references: [id])

  productId String
  product   Product @relation(fields: [productId], references: [id])
  unitId    String?
  unit      Unit?   @relation(fields: [unitId], references: [id])

  conversionFactor Decimal @default(1) @db.Decimal(10, 4)

  description String
  quantity    Decimal @db.Decimal(10, 2)
  unitCost    Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  total       Decimal @db.Decimal(12, 2)

  hsnCode    String?
  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstRate   Decimal @default(0) @db.Decimal(5, 2)
  sgstRate   Decimal @default(0) @db.Decimal(5, 2)
  igstRate   Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stockLot StockLot?

  @@index([organizationId])
  @@map("purchase_invoice_items")
}

// ==================== CREDIT NOTES (SALES RETURNS) ====================

model CreditNote {
  id               String       @id @default(cuid())
  creditNoteNumber String
  organizationId   String
  organization     Organization @relation(fields: [organizationId], references: [id])

  invoiceId String?
  invoice   Invoice? @relation(fields: [invoiceId], references: [id])

  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])

  createdById String?
  createdBy   User?   @relation(fields: [createdById], references: [id])

  issueDate DateTime @default(now())

  subtotal Decimal @db.Decimal(12, 2)
  total    Decimal @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  appliedToBalance Boolean @default(true)
  reason           String?
  notes            String?

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items                CreditNoteItem[]
  customerTransactions CustomerTransaction[]

  @@unique([organizationId, creditNoteNumber])
  @@index([organizationId])
  @@map("credit_notes")
}

model CreditNoteItem {
  id             String       @id @default(cuid())
  creditNoteId   String
  creditNote     CreditNote   @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  invoiceItemId String?

  productId String?
  product   Product? @relation(fields: [productId], references: [id])
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])

  conversionFactor Decimal @default(1) @db.Decimal(10, 4)

  description String
  quantity    Decimal @db.Decimal(10, 2)
  unitPrice   Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  total       Decimal @db.Decimal(12, 2)

  hsnCode    String?
  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstRate   Decimal @default(0) @db.Decimal(5, 2)
  sgstRate   Decimal @default(0) @db.Decimal(5, 2)
  igstRate   Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  originalCOGS Decimal @default(0) @db.Decimal(12, 2)

  stockLotId String?   @unique
  stockLot   StockLot?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizationId])
  @@map("credit_note_items")
}

// ==================== DEBIT NOTES (PURCHASE RETURNS) ====================

model DebitNote {
  id              String       @id @default(cuid())
  debitNoteNumber String
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id])

  purchaseInvoiceId String?
  purchaseInvoice   PurchaseInvoice? @relation(fields: [purchaseInvoiceId], references: [id])

  supplierId String
  supplier   Supplier @relation(fields: [supplierId], references: [id])

  issueDate DateTime @default(now())

  subtotal Decimal @db.Decimal(12, 2)
  total    Decimal @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  appliedToBalance Boolean @default(true)
  reason           String?
  notes            String?

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items                DebitNoteItem[]
  supplierTransactions SupplierTransaction[]

  @@unique([organizationId, debitNoteNumber])
  @@index([organizationId])
  @@map("debit_notes")
}

model DebitNoteItem {
  id             String       @id @default(cuid())
  debitNoteId    String
  debitNote      DebitNote    @relation(fields: [debitNoteId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  purchaseInvoiceItemId String?

  productId String
  product   Product @relation(fields: [productId], references: [id])
  unitId    String?
  unit      Unit?   @relation(fields: [unitId], references: [id])

  conversionFactor Decimal @default(1) @db.Decimal(10, 4)

  description String
  quantity    Decimal @db.Decimal(10, 2)
  unitCost    Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  total       Decimal @db.Decimal(12, 2)

  hsnCode    String?
  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstRate   Decimal @default(0) @db.Decimal(5, 2)
  sgstRate   Decimal @default(0) @db.Decimal(5, 2)
  igstRate   Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lotConsumptions DebitNoteLotConsumption[]

  @@index([organizationId])
  @@map("debit_note_items")
}

model DebitNoteLotConsumption {
  id              String        @id @default(cuid())
  debitNoteItemId String
  debitNoteItem   DebitNoteItem @relation(fields: [debitNoteItemId], references: [id], onDelete: Cascade)
  organizationId  String
  organization    Organization  @relation(fields: [organizationId], references: [id])

  stockLotId String
  stockLot   StockLot @relation(fields: [stockLotId], references: [id])

  quantityReturned Decimal @db.Decimal(10, 2)
  unitCost         Decimal @db.Decimal(10, 2)
  totalCost        Decimal @db.Decimal(12, 2)

  createdAt DateTime @default(now())

  @@index([debitNoteItemId])
  @@index([stockLotId])
  @@index([organizationId])
  @@map("debit_note_lot_consumptions")
}

// ==================== PAYMENTS (FROM CUSTOMERS) ====================

model Payment {
  id             String       @id @default(cuid())
  paymentNumber  String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])

  invoiceId String?
  invoice   Invoice? @relation(fields: [invoiceId], references: [id])

  amount           Decimal       @db.Decimal(12, 2)
  discountReceived Decimal       @default(0) @db.Decimal(12, 2)
  paymentDate      DateTime      @default(now())
  paymentMethod    PaymentMethod @default(CASH)
  reference        String?
  notes            String?

  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  allocations PaymentAllocation[]

  @@unique([organizationId, paymentNumber])
  @@index([organizationId])
  @@index([organizationId, paymentDate(sort: Desc)])
  @@index([organizationId, createdAt(sort: Desc)])
  @@map("payments")
}

model PaymentAllocation {
  id             String       @id @default(cuid())
  paymentId      String
  payment        Payment      @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  invoiceId      String
  invoice        Invoice      @relation(fields: [invoiceId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  amount         Decimal      @db.Decimal(12, 2)
  createdAt      DateTime     @default(now())

  @@index([paymentId])
  @@index([invoiceId])
  @@index([organizationId])
  @@map("payment_allocations")
}

// ==================== SUPPLIER PAYMENTS (TO SUPPLIERS) ====================

model SupplierPayment {
  id             String       @id @default(cuid())
  paymentNumber  String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  supplierId String
  supplier   Supplier @relation(fields: [supplierId], references: [id])

  purchaseInvoiceId String?
  purchaseInvoice   PurchaseInvoice? @relation(fields: [purchaseInvoiceId], references: [id])

  amount        Decimal       @db.Decimal(12, 2)
  discountGiven Decimal       @default(0) @db.Decimal(12, 2)
  paymentDate   DateTime      @default(now())
  paymentMethod PaymentMethod @default(CASH)
  reference     String?
  notes         String?

  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  allocations SupplierPaymentAllocation[]

  @@unique([organizationId, paymentNumber])
  @@index([organizationId])
  @@index([organizationId, paymentDate(sort: Desc)])
  @@index([organizationId, createdAt(sort: Desc)])
  @@map("supplier_payments")
}

model SupplierPaymentAllocation {
  id                String          @id @default(cuid())
  supplierPaymentId String
  supplierPayment   SupplierPayment @relation(fields: [supplierPaymentId], references: [id], onDelete: Cascade)
  purchaseInvoiceId String
  purchaseInvoice   PurchaseInvoice @relation(fields: [purchaseInvoiceId], references: [id])
  organizationId    String
  organization      Organization    @relation(fields: [organizationId], references: [id])
  amount            Decimal         @db.Decimal(12, 2)
  createdAt         DateTime        @default(now())

  @@index([supplierPaymentId])
  @@index([purchaseInvoiceId])
  @@index([organizationId])
  @@map("supplier_payment_allocations")
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CHECK
  CREDIT_CARD
  UPI
  OTHER
}

enum InvoiceSourceType {
  MANUAL
  POS
}

enum POSSessionStatus {
  OPEN
  CLOSED
}

// ==================== INVENTORY / STOCK ====================

model StockLot {
  id             String       @id @default(cuid())
  productId      String
  product        Product      @relation(fields: [productId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  sourceType            StockSourceType
  purchaseInvoiceItemId String?              @unique
  purchaseInvoiceItem   PurchaseInvoiceItem? @relation(fields: [purchaseInvoiceItemId], references: [id])
  purchaseInvoiceId     String?
  purchaseInvoice       PurchaseInvoice?     @relation(fields: [purchaseInvoiceId], references: [id])
  openingStockId        String?              @unique
  openingStock          OpeningStock?        @relation(fields: [openingStockId], references: [id])
  creditNoteItemId      String?              @unique
  creditNoteItem        CreditNoteItem?      @relation(fields: [creditNoteItemId], references: [id])

  stockTransferId String?

  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  lotDate           DateTime
  unitCost          Decimal  @db.Decimal(10, 2)
  initialQuantity   Decimal  @db.Decimal(10, 2)
  remainingQuantity Decimal  @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  consumptions          StockLotConsumption[]
  debitNoteConsumptions DebitNoteLotConsumption[]

  @@index([productId, lotDate])
  @@index([productId, remainingQuantity])
  @@index([organizationId])
  @@index([organizationId, lotDate(sort: Desc)])
  @@index([warehouseId])
  @@map("stock_lots")
}

enum StockSourceType {
  PURCHASE
  OPENING_STOCK
  ADJUSTMENT
  CREDIT_NOTE
  STOCK_TRANSFER
}

model StockLotConsumption {
  id             String       @id @default(cuid())
  stockLotId     String
  stockLot       StockLot     @relation(fields: [stockLotId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  invoiceItemId String
  invoiceItem   InvoiceItem @relation(fields: [invoiceItemId], references: [id], onDelete: Cascade)

  quantityConsumed Decimal @db.Decimal(10, 2)
  unitCost         Decimal @db.Decimal(10, 2)
  totalCost        Decimal @db.Decimal(12, 2)

  createdAt DateTime @default(now())

  @@index([stockLotId])
  @@index([invoiceItemId])
  @@index([organizationId])
  @@map("stock_lot_consumptions")
}

model OpeningStock {
  id             String       @id @default(cuid())
  productId      String
  product        Product      @relation(fields: [productId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  quantity  Decimal  @db.Decimal(10, 2)
  unitCost  Decimal  @db.Decimal(10, 2)
  stockDate DateTime

  notes String?

  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stockLot StockLot?

  @@index([organizationId])
  @@map("opening_stocks")
}

// ==================== COST AUDIT LOG ====================

model CostAuditLog {
  id             String       @id @default(cuid())
  productId      String
  product        Product      @relation(fields: [productId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  invoiceItemId String
  invoiceItem   InvoiceItem @relation(fields: [invoiceItemId], references: [id], onDelete: Cascade)

  oldCOGS      Decimal @db.Decimal(12, 2)
  newCOGS      Decimal @db.Decimal(12, 2)
  changeAmount Decimal @db.Decimal(12, 2)

  changeReason String
  triggeredBy  String?

  changedAt DateTime @default(now())

  @@index([productId, changedAt])
  @@index([invoiceItemId])
  @@index([organizationId])
  @@map("cost_audit_logs")
}

// ==================== CUSTOMER TRANSACTIONS (FOR STATEMENT) ====================

model CustomerTransaction {
  id             String       @id @default(cuid())
  customerId     String
  customer       Customer     @relation(fields: [customerId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  transactionType CustomerTransactionType
  transactionDate DateTime
  amount          Decimal                 @db.Decimal(12, 2)
  description     String

  invoiceId    String?
  paymentId    String?
  creditNoteId String?
  creditNote   CreditNote? @relation(fields: [creditNoteId], references: [id])

  runningBalance Decimal @db.Decimal(12, 2)

  createdAt DateTime @default(now())

  @@index([customerId, transactionDate])
  @@index([organizationId])
  @@index([organizationId, transactionDate(sort: Desc)])
  @@map("customer_transactions")
}

enum CustomerTransactionType {
  OPENING_BALANCE
  INVOICE
  PAYMENT
  CREDIT_NOTE
  ADJUSTMENT
}

// ==================== SUPPLIER TRANSACTIONS (FOR STATEMENT) ====================

model SupplierTransaction {
  id             String       @id @default(cuid())
  supplierId     String
  supplier       Supplier     @relation(fields: [supplierId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  transactionType SupplierTransactionType
  transactionDate DateTime
  amount          Decimal                 @db.Decimal(12, 2)
  description     String

  purchaseInvoiceId String?
  supplierPaymentId String?
  debitNoteId       String?
  debitNote         DebitNote? @relation(fields: [debitNoteId], references: [id])

  runningBalance Decimal @db.Decimal(12, 2)

  createdAt DateTime @default(now())

  @@index([supplierId, transactionDate])
  @@index([organizationId])
  @@index([organizationId, transactionDate(sort: Desc)])
  @@map("supplier_transactions")
}

enum SupplierTransactionType {
  OPENING_BALANCE
  PURCHASE_INVOICE
  PAYMENT
  DEBIT_NOTE
  ADJUSTMENT
}

// ==================== PRODUCT CATEGORIES ====================

model ProductCategory {
  id             String       @id @default(cuid())
  name           String
  slug           String
  color          String?      @default("#6366f1")
  sortOrder      Int          @default(0)
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  products Product[]

  @@unique([organizationId, slug])
  @@index([organizationId])
  @@map("product_categories")
}

// ==================== POS (POINT OF SALE) ====================

model POSSession {
  id                String           @id @default(cuid())
  sessionNumber     String
  organizationId    String
  organization      Organization     @relation(fields: [organizationId], references: [id])
  userId            String
  user              User             @relation(fields: [userId], references: [id])
  status            POSSessionStatus @default(OPEN)
  openedAt          DateTime         @default(now())
  closedAt          DateTime?
  openingCash       Decimal          @default(0) @db.Decimal(12, 2)
  closingCash       Decimal?         @db.Decimal(12, 2)
  expectedCash      Decimal?         @db.Decimal(12, 2)
  cashDifference    Decimal?         @db.Decimal(12, 2)
  totalSales        Decimal          @default(0) @db.Decimal(12, 2)
  totalTransactions Int              @default(0)
  notes             String?

  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  invoices   Invoice[]
  heldOrders POSHeldOrder[]

  @@unique([organizationId, sessionNumber])
  @@index([organizationId])
  @@index([organizationId, openedAt(sort: Desc)])
  @@index([userId])
  @@index([warehouseId])
  @@map("pos_sessions")
}

model POSHeldOrder {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  sessionId      String
  session        POSSession   @relation(fields: [sessionId], references: [id])
  customerId     String?
  customer       Customer?    @relation(fields: [customerId], references: [id])
  customerName   String?
  items          Json
  subtotal       Decimal      @db.Decimal(12, 2)
  notes          String?
  heldAt         DateTime     @default(now())

  @@index([organizationId])
  @@index([sessionId])
  @@map("pos_held_orders")
}

// ==================== SETTINGS ====================

model Setting {
  id             String       @id @default(cuid())
  key            String
  value          String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@unique([organizationId, key])
  @@index([organizationId])
  @@map("settings")
}

// ==================== ACCOUNTING ====================

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum AccountSubType {
  CURRENT_ASSET
  FIXED_ASSET
  BANK
  CASH
  ACCOUNTS_RECEIVABLE
  INVENTORY
  OTHER_ASSET
  CURRENT_LIABILITY
  LONG_TERM_LIABILITY
  ACCOUNTS_PAYABLE
  OTHER_LIABILITY
  OWNERS_EQUITY
  RETAINED_EARNINGS
  OTHER_EQUITY
  SALES_REVENUE
  OTHER_REVENUE
  COST_OF_GOODS_SOLD
  OPERATING_EXPENSE
  PAYROLL_EXPENSE
  OTHER_EXPENSE
}

enum JournalEntryStatus {
  DRAFT
  POSTED
  VOID
}

enum JournalSourceType {
  MANUAL
  INVOICE
  PURCHASE_INVOICE
  PAYMENT
  SUPPLIER_PAYMENT
  EXPENSE
  CREDIT_NOTE
  DEBIT_NOTE
  TRANSFER
  OPENING_BALANCE
}

enum ExpenseStatus {
  DRAFT
  APPROVED
  PAID
  VOID
}

enum CashBankTransactionType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER_IN
  TRANSFER_OUT
  OPENING_BALANCE
}

// ==================== CHART OF ACCOUNTS ====================

model Account {
  id             String         @id @default(cuid())
  code           String
  name           String
  accountType    AccountType
  accountSubType AccountSubType
  description    String?
  parentId       String?
  parent         Account?       @relation("AccountTree", fields: [parentId], references: [id])
  children       Account[]      @relation("AccountTree")
  isSystem       Boolean        @default(false)
  isActive       Boolean        @default(true)
  organizationId String
  organization   Organization   @relation(fields: [organizationId], references: [id])
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  journalEntryLines JournalEntryLine[]
  expenseItems      ExpenseItem[]
  cashBankAccount   CashBankAccount?

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([parentId])
  @@map("accounts")
}

// ==================== CASH & BANK ACCOUNTS ====================

model CashBankAccount {
  id             String         @id @default(cuid())
  name           String
  accountId      String         @unique
  account        Account        @relation(fields: [accountId], references: [id])
  accountSubType AccountSubType // BANK or CASH
  bankName       String?
  accountNumber  String?
  balance        Decimal        @default(0) @db.Decimal(12, 2)
  isDefault      Boolean        @default(false)
  isActive       Boolean        @default(true)

  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  transactions CashBankTransaction[]
  expenses     Expense[]

  @@unique([organizationId, name])
  @@index([organizationId])
  @@index([branchId])
  @@map("cash_bank_accounts")
}

model CashBankTransaction {
  id                String                  @id @default(cuid())
  cashBankAccountId String
  cashBankAccount   CashBankAccount         @relation(fields: [cashBankAccountId], references: [id])
  transactionType   CashBankTransactionType
  amount            Decimal                 @db.Decimal(12, 2)
  runningBalance    Decimal                 @db.Decimal(12, 2)
  description       String
  referenceType     String?
  referenceId       String?
  transactionDate   DateTime
  organizationId    String
  organization      Organization            @relation(fields: [organizationId], references: [id])
  createdAt         DateTime                @default(now())

  @@index([cashBankAccountId, transactionDate])
  @@index([organizationId])
  @@index([organizationId, transactionDate(sort: Desc)])
  @@map("cash_bank_transactions")
}

// ==================== EXPENSES ====================

model Expense {
  id                String           @id @default(cuid())
  expenseNumber     String
  status            ExpenseStatus    @default(DRAFT)
  supplierId        String?
  supplier          Supplier?        @relation(fields: [supplierId], references: [id])
  cashBankAccountId String?
  cashBankAccount   CashBankAccount? @relation(fields: [cashBankAccountId], references: [id])
  expenseDate       DateTime         @default(now())
  description       String?
  subtotal          Decimal          @db.Decimal(12, 2)
  total             Decimal          @db.Decimal(12, 2)

  totalCgst     Decimal @default(0) @db.Decimal(12, 2)
  totalSgst     Decimal @default(0) @db.Decimal(12, 2)
  totalIgst     Decimal @default(0) @db.Decimal(12, 2)
  placeOfSupply String?
  isInterState  Boolean @default(false)

  notes          String?
  journalEntryId String?
  journalEntry   JournalEntry? @relation(fields: [journalEntryId], references: [id])

  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  items ExpenseItem[]

  @@unique([organizationId, expenseNumber])
  @@index([organizationId])
  @@index([organizationId, expenseDate(sort: Desc)])
  @@index([organizationId, status])
  @@map("expenses")
}

model ExpenseItem {
  id          String  @id @default(cuid())
  expenseId   String
  expense     Expense @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  accountId   String
  account     Account @relation(fields: [accountId], references: [id])
  description String
  amount      Decimal @db.Decimal(12, 2)

  gstRate    Decimal @default(0) @db.Decimal(5, 2)
  cgstAmount Decimal @default(0) @db.Decimal(12, 2)
  sgstAmount Decimal @default(0) @db.Decimal(12, 2)
  igstAmount Decimal @default(0) @db.Decimal(12, 2)

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([expenseId])
  @@index([organizationId])
  @@map("expense_items")
}

// ==================== JOURNAL ENTRIES ====================

model JournalEntry {
  id            String             @id @default(cuid())
  journalNumber String
  date          DateTime
  description   String
  status        JournalEntryStatus @default(DRAFT)
  sourceType    JournalSourceType  @default(MANUAL)
  sourceId      String?

  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  lines    JournalEntryLine[]
  expenses Expense[]

  @@unique([organizationId, journalNumber])
  @@index([organizationId])
  @@index([organizationId, date(sort: Desc)])
  @@index([organizationId, status])
  @@index([sourceType, sourceId])
  @@index([branchId])
  @@map("journal_entries")
}

model JournalEntryLine {
  id             String       @id @default(cuid())
  journalEntryId String
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  accountId      String
  account        Account      @relation(fields: [accountId], references: [id])
  description    String?
  debit          Decimal      @default(0) @db.Decimal(12, 2)
  credit         Decimal      @default(0) @db.Decimal(12, 2)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())

  @@index([journalEntryId])
  @@index([accountId])
  @@index([organizationId])
  @@map("journal_entry_lines")
}

// ==================== BRANCHES & WAREHOUSES ====================

model Branch {
  id             String       @id @default(cuid())
  name           String
  code           String
  address        String?
  city           String?
  state          String?
  phone          String?
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  warehouses         Warehouse[]
  invoices           Invoice[]
  quotations         Quotation[]
  purchaseInvoices   PurchaseInvoice[]
  creditNotes        CreditNote[]
  debitNotes         DebitNote[]
  payments           Payment[]
  supplierPayments   SupplierPayment[]
  posSessions        POSSession[]
  cashBankAccounts   CashBankAccount[]
  journalEntries     JournalEntry[]
  expenses           Expense[]
  stockTransfersFrom StockTransfer[]       @relation("SourceBranch")
  stockTransfersTo   StockTransfer[]       @relation("DestinationBranch")
  userAccess         UserWarehouseAccess[]

  @@unique([organizationId, code])
  @@index([organizationId])
  @@map("branches")
}

model Warehouse {
  id             String       @id @default(cuid())
  name           String
  code           String
  branchId       String
  branch         Branch       @relation(fields: [branchId], references: [id])
  address        String?
  isActive       Boolean      @default(true)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  invoices           Invoice[]
  quotations         Quotation[]
  purchaseInvoices   PurchaseInvoice[]
  creditNotes        CreditNote[]
  debitNotes         DebitNote[]
  posSessions        POSSession[]
  stockLots          StockLot[]
  openingStocks      OpeningStock[]
  stockTransfersFrom StockTransfer[]       @relation("SourceWarehouse")
  stockTransfersTo   StockTransfer[]       @relation("DestinationWarehouse")
  stockTransferItems StockTransferItem[]
  userAccess         UserWarehouseAccess[]

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([branchId])
  @@map("warehouses")
}

// ==================== STOCK TRANSFERS ====================

model StockTransfer {
  id             String       @id @default(cuid())
  transferNumber String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  sourceBranchId    String
  sourceBranch      Branch    @relation("SourceBranch", fields: [sourceBranchId], references: [id])
  sourceWarehouseId String
  sourceWarehouse   Warehouse @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])

  destinationBranchId    String
  destinationBranch      Branch    @relation("DestinationBranch", fields: [destinationBranchId], references: [id])
  destinationWarehouseId String
  destinationWarehouse   Warehouse @relation("DestinationWarehouse", fields: [destinationWarehouseId], references: [id])

  status       StockTransferStatus @default(DRAFT)
  transferDate DateTime            @default(now())
  approvedAt   DateTime?
  shippedAt    DateTime?
  completedAt  DateTime?
  cancelledAt  DateTime?
  reversedAt   DateTime?

  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items StockTransferItem[]

  @@unique([organizationId, transferNumber])
  @@index([organizationId])
  @@index([organizationId, transferDate(sort: Desc)])
  @@index([organizationId, status])
  @@map("stock_transfers")
}

enum StockTransferStatus {
  DRAFT
  APPROVED
  IN_TRANSIT
  COMPLETED
  CANCELLED
  REVERSED
}

model StockTransferItem {
  id              String        @id @default(cuid())
  stockTransferId String
  stockTransfer   StockTransfer @relation(fields: [stockTransferId], references: [id], onDelete: Cascade)
  organizationId  String
  organization    Organization  @relation(fields: [organizationId], references: [id])

  productId   String
  product     Product    @relation(fields: [productId], references: [id])
  warehouseId String?
  warehouse   Warehouse? @relation(fields: [warehouseId], references: [id])

  quantity Decimal @db.Decimal(10, 2)
  unitCost Decimal @default(0) @db.Decimal(10, 2)
  notes    String?

  createdAt DateTime @default(now())

  @@index([stockTransferId])
  @@index([organizationId])
  @@map("stock_transfer_items")
}

// ==================== USER WAREHOUSE ACCESS ====================

model UserWarehouseAccess {
  id             String       @id @default(cuid())
  userId         String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  branchId       String
  branch         Branch       @relation(fields: [branchId], references: [id], onDelete: Cascade)
  warehouseId    String
  warehouse      Warehouse    @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  isDefault      Boolean      @default(false)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())

  @@unique([userId, warehouseId])
  @@index([userId])
  @@index([organizationId])
  @@map("user_warehouse_access")
}
